#' Rysowanie wizytówki dla strategii
#'
#' Funkcja rysuje wizytówkę do pliku pdf przedstawiającą podstawowe statystyki dotyczące badanej strategii, w odniesieniu do strategii SuperFarmerDA
#'
#' @param strategia strategia do zwizualizowania
#' @param plik nazwa pliku, no którego zostanie zapisana wizytówka
#' 
#' @author
#' Michal Kotlewski ,\email{michal.kotlewski@student.uw.edu.pl}
#' @author
#' Mateusz Siwiec, \email{ms332521@students.mimuw.edu.pl}
#'
#' @rdname rysuj_wizytowke
#' 
#' @export

rysuj_wizytowke <- function(strategia, plik="wizytowka.pdf") {

  nazwa.strategii = as.character(substitute(strategia))
  
  wyniki1 = round(abs(rnorm(2000, 50, 25)) + 1)
  wyniki2 = c(116,38,190,21,78,41,111,57,94,70,69,54,43,58,41,29,74,67,69,91,51,47,61,27,78,40,50,39,37,108,102,106,41,91,86,43,100,57,41,50,66,66,66,131,101,42,62,18,102,93,54,129,105,39,39,28,46,67,62,69,28,30,89,40,154,27,88,67,56,49,25,137,149,139,36,91,44,27,259,44,28,73,36,47,21,91,85,66,47,27,134,65,51,20,48,23,142,78,27,60,33,32,53,109,31,153,45,111,39,30,119,64,146,70,98,111,75,51,100,46,61,156,84,109,46,86,85,37,76,68,72,181,26,24,120,32,119,47,111,62,47,52,38,109,37,233,118,130,40,84,112,115,125,39,18,54,209,131,39,30,155,42,52,52,42,87,46,50,34,95,24,73,75,97,27,57,50,20,71,53,50,37,73,91,27,33,27,43,55,35,43,70,27,99,90,48,45,42,40,69,56,196,57,44,69,45,135,119,103,81,83,44,91,76,215,95,85,35,184,23,54,96,80,26,24,31,117,69,51,30,132,52,65,93,138,46,98,56,66,69,67,69,35,108,27,153,49,57,47,80,102,33,81,44,138,175,38,48,18,63,118,127,37,105,49,72,22,50,48,194,59,112,98,32,33,78,140,36,21,44,108,134,55,29,39,54,41,104,48,26,101,29,123,84,28,74,69,46,38,28,32,49,66,44,41,81,76,43,200,68,88,27,62,34,40,17,31,79,37,176,97,127,102,66,48,32,113,82,41,31,42,34,57,44,49,56,79,123,48,50,73,43,242,61,54,95,98,50,36,41,76,106,68,66,94,47,36,109,56,55,31,148,20,35,39,44,40,122,49,49,49,214,41,33,40,127,67,62,33,44,27,124,38,55,45,59,28,62,70,30,27,43,64,75,32,62,84,107,191,151,32,73,31,93,180,103,55,41,25,88,195,48,100,49,98,78,217,88,37,194,55,51,29,53,65,87,34,89,197,41,17,77,43,92,68,30,65,111,48,36,58,119,27,64,42,33,185,176,62,32,70,69,43,51,15,108,58,111,56,35,48,62,30,40,47,107,111,79,54,197,82,33,23,79,124,29,48,102,127,72,91,72,35,32,52,68,29,147,199,37,45,63,88,55,42,61,83,208,153,29,73,60,51,34,36,42,45,35,61,122,59,28,66,25,45,53,27,64,91,69,91,23,50,72,28,35,46,67,88,54,27,77,22,91,35,81,83,75,27,86,41,126,17,135,48,31,47,33,120,82,39,51,51,38,35,132,48,77,43,28,144,143,23,43,41,41,21,60,61,111,57,62,47,66,128,58,70,81,27,119,37,73,53,30,231,59,108,74,53,37,21,53,24,99,66,40,142,70,44,117,32,39,67,70,62,64,40,39,44,74,27,91,87,63,90,30,50,24,65,51,50,38,30,31,68,64,118,59,35,71,51,94,22,98,27,34,82,57,73,69,96,129,255,75,28,205,74,138,62,58,56,105,40,61,25,61,39,88,113,218,74,82,71,123,62,47,42,47,75,38,31,62,54,42,76,26,98,28,34,70,175,58,42,86,150,20,118,28,63,259,41,64,195,88,58,172,53,61,59,60,68,48,113,66,57,98,33,56,108,89,52,42,58,55,104,51,82,66,99,126,51,71,49,116,102,143,70,77,56,73,173,137,85,56,75,53,55,177,20,52,75,38,59,39,70,160,64,53,40,37,70,138,55,33,48,28,70,84,115,58,136,79,38,37,65,55,87,60,63,112,103,71,76,28,82,35,121,113,71,76,78,84,32,48,57,25,48,56,85,37,46,115,65,59,32,38,115,45,28,43,67,68,52,41,64,68,117,64,44,33,36,374,37,93,43,40,70,41,65,58,38,159,108,73,84,94,165,55,181,166,76,78,27,59,28,33,21,71,41,32,43,26,49,103,91,41,110,144,38,89,41,89,40,38,75,28,39,36,61,73,40,99,61,58,27,27,40,55,59,43,36,29,95,15,40,19,22,31,44,77,53,65,33,108,47,125,117,97,47,73,33,136,42,55,69,31,46,27,47,55,39,114,66,43,91,33,51,40,132,217,49,41,123,43,35,24,98,36,64,85,28,61,25,69,65,37,43,57,79,37,50,43,120,140,62,119,37,18,75,67,176,64,38,58,51,46,59,87,71,51,66,203,69,38,122,32,86,60,38,86,96,82,55,54,101,42,140,62,54,65,32,48,55,173,41,64,47,105,26,28,44,74,51,133,43,29,45,48,105,47,87,72,136,72,80,46,25,175,56,40,80,110,110,68,41,37,63,30,93,100,38,32,41,40,69,108,75,23,20,31,57,83,17,115,55,51,27,59,29,38,81,42,46,34,97,146,45,59,88,44,63,77,128,56,47,28,40,58,125,85,36,123,152,38,22,28,53,98,30,142,69,89,117,97,84,47,142,50,43,59,52,83,32,108,181,61,53,93,64,106,158,51,69,41,36,123,52,72,101,45,31,35,35,34,42,56,27,183,78,58,58,116,47,40,80,222,68,146,70,73,54,187,25,78,70,71,62,23,79,146,26,172,88,30,66,68,55,116,54,135,29,52,147,54,38,28,31,39,87,37,104,61,91,67,105,25,38,109,26,30,39,34,59,55,83,41,77,80,30,158,161,42,66,40,38,68,19,29,20,42,151,197,36,82,44,117,83,60,45,27,27,44,79,204,108,71,84,112,36,106,46,42,31,42,72,197,54,210,30,44,120,32,82,47,36,89,119,122,133,40,71,22,92,37,90,56,98,18,84,36,42,168,64,53,42,147,22,55,134,106,44,60,57,45,108,29,66,38,30,147,36,79,24,31,93,47,59,97,67,68,35,77,95,40,43,38,97,97,105,55,56,50,101,90,54,45,48,40,59,32,31,26,62,40,100,75,63,103,117,78,36,291,71,33,36,199,29,162,93,108,61,170,61,42,94,38,169,62,43,54,77,56,78,39,52,71,107,73,111,132,65,75,49,60,26,49,124,126,38,49,156,56,62,41,39,31,23,38,99,56,72,78,79,55,98,50,39,27,70,53,33,86,87,111,47,246,95,45,67,32,94,78,118,73,67,48,29,92,88,113,89,38,36,69,87,41,80,47,35,39,52,95,105,67,54,65,99,124,170,37,83,47,46,89,51,33,81,74,49,142,35,72,23,130,49,205,68,50,80,83,69,62,112,62,46,46,56,166,91,84,24,26,103,46,72,34,48,42,87,33,64,107,42,36,45,82,33,38,34,59,282,87,94,101,59,80,65,32,48,32,47,63,91,72,67,87,47,65,26,177,42,50,29,72,36,42,18,26,79,139,91,32,39,115,57,60,98,72,64,92,47,53,47,141,60,266,42,27,234,56,17,30,38,65,129,85,92,64,93,69,35,18,22,212,71,40,59,170,92,57,37,28,70,72,37,34,90,26,56,85,76,40,20,88,96,47,61,69,122,76,103,139,28,119,52,33,74,71,24,23,35,57,39,123,26,29,32,28,58,81,54,127,88,99,140,29,62,68,67,85,28,39,116,53,30,90,120,31,94,37,109,40,173,80,60,101,36,176,59,144,51,87,77,80,25,32,16,35,57,96,47,109,79,58,86,158,40,98,69,51,68,93,47,66,33,165,42,56,45,24,81,38,77,42,83,24,47,32,63,164,157,22,39,87,62,30,82,33,61,62,69,60,67,58,72,67,29,66,62,55,52,56,23,37,70,113,32,55,41,43,120,54,128,95,57,58,19,50,82,56,39,92,32,35,68,59,35,21,48,25,112,113,114,67,89,57,80,66,39,40,21,58,22,20,29,76,49,45,70,202,53,48,53,59,57,21,77,39,46,106,81,57,48,90,116,22,83,56,31,52,71,82,121,73,53,132,101,44,94,79,39,141,39,22,33,34,29,86,64,71,98,29,50,167,79,30,41,122,51,47,46,33,112,65,36,47,87,76,20,116,29,36,43,33,92,30,49,27,74,93,18,43,85,26,94,76,132,80,62,67,44,32,157,86,105,73,50,79,44,27,80,49,28,149,78,39,63,74,85,35,37,26,43,60,37,30,46,97,39,46,44,20,40,54,47,162,51,99,85,77,56,24,95,37,50,182,107,58,41,29,47,109,34,41,39,32,41,122,168,41,50,242,135,22,138,47,37,130,143,112,70,28,68,32,35,32,26,71,36,60,50,21,65,66,21,98,21,162,67,94,133,100,58,72,97,29,90,90,59,63,68,38,41,85,56,75,55,256,39,29,33,66,29,133,128,29,30,87,46,77,50,79,246,20,142,51,94,80,145,29,52,66,37,68,59,15,56,57,36,40,36,22,22,51,31,76,70,59,101,47,49,36,79,81,48,43,21,35,101,139,45,44,78,123,68,194,63,42,23,39,46,43,204,43,67,239,52,90,29,93,130,46,57,79,57,38,66,68,36,96,29,45,109,76,69,58,39,44,82,55,67,40,50,50,36,39,31,59,57,41,189,48,50,55,61,169,87,27,42,63,88,57,100,41,51,60,70,36,97,29,26,61,42,62,50,41,41,80,54,155)
  
  
  shortest <- min(length(wyniki1), length(wyniki2))
  wyniki1 <- tail(wyniki1, shortest)
  wyniki2 <- tail(wyniki2, shortest)
  
  v1 = c(nazwa.strategii,   format(round(mean(wyniki1), 2), nsmall = 2), format(round(median(wyniki1), 1), nsmall = 1), min(wyniki1), max(wyniki1), length(wyniki1), format(round(sd(wyniki1), 2), nsmall = 2))
  v2 = c("SuperFarmerDA", format(round(mean(wyniki2), 2), nsmall = 2), format(round(median(wyniki2), 1), nsmall = 1), min(wyniki2), max(wyniki2), length(wyniki2), format(round(sd(wyniki2), 2), nsmall = 2))
  
  d <- rbind.data.frame(v1, v2)
  
  cols <- matrix("black", nrow(d), ncol(d))
  cols[1,2:7] <- "red"
  cols[2,2:7] <- "blue"
  tt <- ttheme_minimal(core=list(fg_params = list(col = cols),
                                 bg_params = list(col=NA)),
                       rowhead=list(bg_params = list(col=NA)),
                       colhead=list(bg_params = list(col=NA)))
  tabela <- tableGrob(d, cols=c("strategia\nname", "Mean", "Median", "Minimal\nvalue", "Maximal\nvalue", "Number of\nrounds", "Standard\ndeviation"),
                      rows = NULL, theme=tt)
  
  
  
  
  q <- c(0.1, 0.25, 0.5, 0.75, 0.9)
  kwantyle <- cbind(as.vector(quantile(wyniki1, q)), as.vector(quantile(wyniki2, q)))
  kwantyle <- round(kwantyle, 1)
  kwantyle <- cbind(c("10%", "25%", "50%", "75%", "90%"), kwantyle)
  cols <- matrix("black", nrow(kwantyle), ncol(kwantyle))
  cols[1:5,2] <- "red"
  cols[1:5,3] <- "blue"
  tt <- ttheme_minimal(core=list(fg_params = list(col = cols),
                                 bg_params = list(col=NA)),
                       rowhead=list(bg_params = list(col=NA)),
                       colhead=list(bg_params = list(col=NA)))
  tabela2 <- tableGrob(kwantyle, theme=tt, rows=NULL,
                       cols=c("Qauntile", nazwa.strategii, "SuperFarmerDA"))
  
  
  
  
  .wyniki1 = as.data.frame(wyniki1)
  .wyniki2 = as.data.frame(wyniki2)
  .wyniki = cbind.data.frame(wyniki1, wyniki2)
  
  histo1 <- ggplot(.wyniki)+
    theme_bw()+
    theme(plot.margin=unit(c(0.5,1.5,1,1.5), "cm"))+
    geom_histogram(aes(x=.wyniki2, y=..density..), colour="white", fill="blue", alpha=.20, position="dodge", bins=100)+
    geom_histogram(aes(x=.wyniki1, y=..density..), colour="white", fill="red", alpha=.60, position="dodge", bins=100)+
    geom_density(alpha=.2, colour="blue", fill="white", aes(x=.wyniki2))+
    geom_density(alpha=.2, colour="red", fill="white", aes(x=.wyniki1))+
    geom_vline(aes(xintercept=mean(wyniki1)), color="darkred", size=1)+
    geom_vline(aes(xintercept=mean(wyniki2)), color="blue", size=1)+
    labs(x = "Number of rounds", y="Frequency")+
    ggtitle("Histogram of frequencies")+
    xlim(0, max(c(wyniki1, wyniki2)))
  
  
  histo2 <- ggplot(.wyniki1)+
    geom_boxplot(aes(x=nazwa.strategii, y=.wyniki1), fill="red")+
    geom_boxplot(aes(x="SuperFarmerDA", y=.wyniki2), fill="blue")+
    theme_bw()+
    theme(plot.margin=unit(c(0,0.5,0,1.5), "cm"))+
    ylab("Rounds")+
    xlab("strategia")+
    ggtitle("Boxplots for the two strategies")
  
  histo3 <- ggplot(.wyniki) + 
    stat_ecdf(aes(x=wyniki1), color="red")+
    stat_ecdf(aes(x=wyniki2), color="blue")+
    theme_bw()+
    theme(plot.margin=unit(c(0,1.5,0,0.5), "cm"))+
    xlab("Rounds")+
    ylab("Cumulative density")+
    ggtitle("Empirical cumulative density\nfunction")
    
  text <- textGrob("strategia SuperFarmerDA was used as a point of reference for all analysed strategies.\nMichal Kotlewski (michal.kotlewski@student.uw.edu.pl),\nMateusz Siwiec (ms332521@students.mimuw.edu.pl)",
                   gp=gpar(fontsize=10, col="grey"))
  title <- textGrob(label=nazwa.strategii, gp=gpar(fontsize=30, col="black"))
    
  lay <- rbind(c(1, 1),
               c(2, 2),
               c(3, 3),
               c(4, 5),
               c(4, 6),
               c(7, 7))
  
  g <- arrangeGrob(title, tabela, histo1, histo2, histo3, tabela2, text, layout_matrix = lay,
                   widths=c(1/2, 1/2), heights=c(0.08, 0.1, 0.3, 0.22, 0.2, 0.1))
  
  ggsave(file=plik, g, width = 210, height = 297, units = "mm")
}